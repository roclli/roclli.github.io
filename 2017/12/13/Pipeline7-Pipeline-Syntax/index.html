<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>(原创)Pipeline7-Pipeline-Syntax | 测试人员修炼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="笔者是独立翻译实验，不允许转载 Pipeline Syntax本节基于入门中介绍的信息, 应仅作为参考进行处理。有关如何在实际示例中使用Pipeline语法的详细信息, 请参阅本章的 Jenkinsfile 部分。在Pipeline插件的2.5 版中, Pipeline支持两个离散的语法, 下面是详细的。对于每个优点和缺点, 请参见语法比较。 正如在入门中所讨论的, Pipeline最基本的部分是">
<meta name="keywords" content="Jenkins; Pipeline; Docker">
<meta property="og:type" content="article">
<meta property="og:title" content="(原创)Pipeline7-Pipeline-Syntax">
<meta property="og:url" content="https://roclli.github.io/2017/12/13/Pipeline7-Pipeline-Syntax/index.html">
<meta property="og:site_name" content="测试人员修炼">
<meta property="og:description" content="笔者是独立翻译实验，不允许转载 Pipeline Syntax本节基于入门中介绍的信息, 应仅作为参考进行处理。有关如何在实际示例中使用Pipeline语法的详细信息, 请参阅本章的 Jenkinsfile 部分。在Pipeline插件的2.5 版中, Pipeline支持两个离散的语法, 下面是详细的。对于每个优点和缺点, 请参见语法比较。 正如在入门中所讨论的, Pipeline最基本的部分是">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/1.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/2.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/3.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/4.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/5.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/6.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/7.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/8.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/9.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/10.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/11.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/12.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/13.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/14.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/15.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/16.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/17.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/18.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/19.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/20.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/21.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/22.png">
<meta property="og:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/23.png">
<meta property="og:updated_time" content="2017-12-13T05:10:27.630Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="(原创)Pipeline7-Pipeline-Syntax">
<meta name="twitter:description" content="笔者是独立翻译实验，不允许转载 Pipeline Syntax本节基于入门中介绍的信息, 应仅作为参考进行处理。有关如何在实际示例中使用Pipeline语法的详细信息, 请参阅本章的 Jenkinsfile 部分。在Pipeline插件的2.5 版中, Pipeline支持两个离散的语法, 下面是详细的。对于每个优点和缺点, 请参见语法比较。 正如在入门中所讨论的, Pipeline最基本的部分是">
<meta name="twitter:image" content="http://oow5aq3zy.bkt.clouddn.com/image/pp7/1.png">
  
    <link rel="alternate" href="/atom.xml" title="测试人员修炼" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">测试人员修炼</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">测试人员的技术博客;交流请加QQ群:549576208</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://roclli.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Pipeline7-Pipeline-Syntax" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/13/Pipeline7-Pipeline-Syntax/" class="article-date">
  <time datetime="2017-12-13T02:09:15.000Z" itemprop="datePublished">2017-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      (原创)Pipeline7-Pipeline-Syntax
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><b>笔者是独立翻译实验，不允许转载<b></b></b></p>
<h1 id="Pipeline-Syntax"><a href="#Pipeline-Syntax" class="headerlink" title="Pipeline Syntax"></a>Pipeline Syntax</h1><p>本节基于入门中介绍的信息, 应仅作为参考进行处理。有关如何在实际示例中使用Pipeline语法的详细信息, 请参阅本章的 Jenkinsfile 部分。在Pipeline插件的2.5 版中, Pipeline支持两个离散的语法, 下面是详细的。对于每个优点和缺点, 请参见语法比较。</p>
<p>正如在入门中所讨论的, Pipeline最基本的部分是步骤step。基本上, 步骤step告诉Jenkins该做什么, 并作为声明式和脚本式Pipeline语法的基本构造块。</p>
<p>有关可用步骤的概述, 请参阅Pipeline步骤参考, 其中包含内置的步骤的全面列表以及插件提供的步骤。</p>
<h2 id="Declarative-Pipeline"><a href="#Declarative-Pipeline" class="headerlink" title="Declarative Pipeline"></a>Declarative Pipeline</h2><p>声明式Pipeline是Jenkins Pipeline的一个相对最近的加法, 它在Pipeline子系统的顶部提供了一种更简化和自以为是的语法。</p>
<p>所有有效的声明Pipeline必须包含在Pipeline块中, 例如:</p>
<p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/1.png"></p>
<p>在声明性Pipeline中有效的基本语句和表达式遵循与 Groovy 语法相同的规则, 但有以下例外情况:</p>
<ul>
<li>Pipeline的 top-level 必须是一个块, 特别是: pipeline {}</li>
<li>没有分号作为语句分隔符。每个语句都必须在自己的行上</li>
<li>块必须由节、指令、步骤或赋值语句组成。</li>
<li>属性引用语句被视为参数方法调用。例如, 输入被视为输入 ()</li>
</ul>
<h4 id="Sections"><a href="#Sections" class="headerlink" title="Sections"></a>Sections</h4><p>声明性Pipeline中的节通常包含一个或多个指令Directive或步骤steps。</p>
<h5 id="agent"><a href="#agent" class="headerlink" title="agent"></a>agent</h5><p>代理部分指定在Jenkins环境中执行整个Pipeline或特定阶段的位置, 具体取决于代理部分的放置位置。该节必须在Pipeline块内的 top-level 中定义, 但阶段级别的时候使用是可选的。</p>
<table><tr><td>Required</td><td>Yes</td></tr><tr><td>Parameters</td><td>Described below</td></tr><tr><td>Allowed</td><td>In the top-level pipeline block and each stage block</td></tr></table>

<h5 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h5><p>为了支持Pipeline作者可能有的各种用例, 代理部分支持几种不同类型的参数。这些参数可在Pipeline块的 top-level 或每个阶段指令中应用。</p>
<h6 id="any"><a href="#any" class="headerlink" title="any"></a>any</h6><p>在任何可用的代理上执行Pipeline或阶段。例如: 代理任何agent any。</p>
<h6 id="none"><a href="#none" class="headerlink" title="none"></a>none</h6><p>当在Pipeline块的 top-level 应用时, 将不会为整个Pipeline运行分配全局代理, 并且每个阶段部分都需要包含其自己的代理部分。例如: 代理无agent none。</p>
<h6 id="label"><a href="#label" class="headerlink" title="label"></a>label</h6><p>使用所提供的标签, 在Jenkins环境中可用的代理上执行Pipeline或stage。例如: 代理 {标签为‘my-defined-label’}。</p>
<h6 id="node"><a href="#node" class="headerlink" title="node"></a>node</h6><p>agent{ node {label ‘labelName’}}}和agent { label ‘labelName’}一样，node允许附加的选项，例如customWorkspace。</p>
<h6 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h6><p>对给定的容器执行Pipeline或stage, 在预先配置为接受 Docker-based Pipeline的节点上或在与可选的标签参数匹配的节点上动态调配。Docker还可以选择接受参数, 其中可能包含直接传递到docker运行调用的参数, 以及一个 alwaysPull 选项, 即使图像名称已存在, 也会强制执行docker。例如 agent { docker ‘maven：3-alpine’}</p>
<p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/2.png"></p>
<h6 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h6><p>使用源存储库中包含的<font color="red">Dockerfile</font>生成的容器来执行Pipeline或stage。要想使用这个选项，<font color="red">Jenkinsfile</font>必须通过Multibranch Pipeline或者Pipeline from SCM。通常这是源存储库根目录中的 <font color="red">Dockerfile</font>：<font color="red">agent { dockerfile true }</font>。如果在另一个目录中生成<font color="red">Dockerfile</font>, 请使用<font color="red">dir</font>选项：<font color="red">agent { dockerfile { dir ‘somSubDir’} }</font>。您可以用<font color="red">additionalBuildArgs</font>选项传递参数到<font color="red">docker build……</font>命令中，像<font color="red">agent { dockerfile { additionalBuildArgs ‘–build-arg foo=bar’ } }</font>。</p>
<h4 id="Common-Options"><a href="#Common-Options" class="headerlink" title="Common Options"></a>Common Options</h4><p>这些是可以应用两个或更多agent实现的几个选项。除非明确说明, 否则不是必需的。</p>
<h6 id="Label"><a href="#Label" class="headerlink" title="Label"></a>Label</h6><p>一个字符串。要在其上运行Pipeline或单个stage的标签。<br>此选项对于node，docker和dockerfile有效，并且对node是必需的。</p>
<h6 id="customWorkspace"><a href="#customWorkspace" class="headerlink" title="customWorkspace"></a>customWorkspace</h6><p>一个字符串。运行Pipeline或单个stage，此agent在该自定义工作区中应用, 而不是默认。它可以是相对路径, 在这种情况下, 自定义工作区将位于节点的工作区根目录下, 或者是绝对路径。例如：</p>
<p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/3.png"></p>
<p>此选项对于node，docker和dockerfile有效。</p>
<h6 id="reuseNode"><a href="#reuseNode" class="headerlink" title="reuseNode"></a>reuseNode</h6><p>布尔值, 默认为 false。如果为 true, 则在Pipeline的 top-level 上指定的节点上, 在同一工作区中, 而不是在新节点上运行容器。</p>
<p>此选项对<font color="red">docker</font>和<font color="red">dockerfile</font>有效, 并且仅在用于单个<font color="red">stage</font>的<font color="red">agent</font>时具有效果。</p>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/4.png"></p>
<p>①在新创建的给定名称和标记(<font color="red">maven:3-alpine</font>)容器中, 执行此Pipeline中定义的所有步骤。</p>
<p>Stage-level <font color="red">agent</font>部分<br><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/5.png"></p>
<ul>
<li><p>在Pipeline的 top-level 定义agent none, 确保不会不必要地分配执行器。使用agent none 还强制每个stage部分包含其自己的agent部分。</p>
</li>
<li><p>使用此image在新创建的容器中执行此阶段中的步骤。</p>
</li>
<li><p>使用上一个阶段的不同image, 在新创建的容器中执行此阶段中的步骤。</p>
</li>
</ul>
<h4 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h4><p>post 部分定义将在Pipeline运行或阶段结束时运行的操作。post 部分中支持许多条件块: 始终(<font color="red">always</font>)、已更改(<font color="red">changed</font>)、失败(<font color="red">failure</font>)、成功(<font color="red">success</font>)、不稳定(<font color="red">unstable</font>)和中止(<font color="red">aborted</font>)。这些块允许在Pipeline运行或阶段的末尾执行步骤, 具体取决于管线的状态。</p>
<table><thead><tr><th>Required</th><th>No</th></tr></thead><tbody><tr>  <td>Parameters</td><td>None</td></tr><tr><td>Allowed</td><td>In the top-level <font color="red">pipeline</font> block and each <font color="red">stage</font> block</td></tr></tbody></table>

<h4 id="Conditions"><a href="#Conditions" class="headerlink" title="Conditions"></a>Conditions</h4><font color="red">always</font>

<p>无论Pipeline运行的完成状态如何, 都将运行。</p>
<font color="red">changed</font>

<p>仅当当前Pipeline运行与以前完成的Pipeline的状态不同时才运行。</p>
<font color="red">failure</font>

<p>只有在当前Pipeline出现故障状态时才运行, 通常在 web UI 中用红色指示表示。</p>
<font color="red">success</font>

<p>只有在当前Pipeline具有成功状态时才运行, 通常在 web UI 中用蓝色或绿色表示。</p>
<font color="red">unstable</font>

<p>只有在当前Pipeline的状态不稳定时才运行, 通常是由测试失败、代码违规等引起的。通常用黄色指示在 web UI 中表示。</p>
<font color="red">aborted</font>

<p>仅在当前Pipeline具有中止状态时运行, 通常是由于Pipeline被手动中止。通常在 web UI 中用灰色指示表示。</p>
<h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/6.png"></p>
<ul>
<li><p>通常情况下, post部分应放置在Pipeline的末尾。</p>
</li>
<li><p>Post-condition块包含与steps部分相同的steps。</p>
</li>
</ul>
<h4 id="stages"><a href="#stages" class="headerlink" title="stages"></a>stages</h4><p>包含一个或多个stage指令的序列, stages部分是Pipeline所描述的大部分”work”的位置。至少建议stages对连续传递过程中的每个离散部分 ，如生成、测试和部署， 至少包含一个阶段指令。</p>
<table><thead><tr><th>Required</th><th>Yes</th></tr></thead><tbody><tr><td>Parameters</td><td>None</td></tr><tr><td>Allowed</td><td>Only once, inside the <font color="red">pipeline</font> block</td></tr></tbody></table>

<h4 id="Example-2"><a href="#Example-2" class="headerlink" title="Example"></a>Example</h4><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/7.png"></p>
<ul>
<li>stage部分通常遵循指令, 如代理<font color="red">agent</font>、选项<font color="red">options</font>等。</li>
</ul>
<h4 id="steps"><a href="#steps" class="headerlink" title="steps"></a>steps</h4><p>steps部分在指定的stage指令中定义一系列一个或多个将要执行的steps。</p>
<table><thead><tr><th>Required</th><th>Yes</th></tr></thead><tbody><tr><td>Parameters</td><td>None</td></tr><tr><td>Allowed</td><td>inside each <font color="red">stage</font> block</td></tr></tbody></table>

<h4 id="Example-3"><a href="#Example-3" class="headerlink" title="Example"></a>Example</h4><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/8.png"></p>
<ul>
<li>steps部分包含一个或多个steps。</li>
</ul>
<h4 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h4><h6 id="environment"><a href="#environment" class="headerlink" title="environment"></a>environment</h6><p>环境<font color="red">environment</font>指令指定一个键值对序列, 它将被定义为所有steps的环境变量, 或特定阶段的steps, 具体取决于环境<font color="red">environment</font>指令在Pipeline中的位置。</p>
<p>此指令支持一种特殊的方法<font color="red">credentials()</font>, 可用于通过Jenkins环境中的标识符来访问预定义的凭据。对于类型为机密文本的凭据, credentials()方法将确保指定的环境变量包含秘密文本内容。对于类型为标准用户名和密码的凭据, 指定的环境变量将被设置为<font color="red">用户名: 密码</font>和另外两个环境变量将被自动定义：<font color="red">MYVARNAME_USR</font>和<font color="red">MYVARNAME_PSW</font>。</p>
<table><thead><tr><th>Required</th><th>No</th></tr></thead><tbody><tr><td>Parameters</td><td>None</td></tr><tr><td>Allowed</td><td>inside the <font color="red">pipeline</font> block, or within <font color="red">stage</font> directives</td></tr></tbody></table>

<h6 id="Example-4"><a href="#Example-4" class="headerlink" title="Example"></a>Example</h6><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/9.png"></p>
<ul>
<li>top-level Pipeline块中使用的environment指令将应用于Pipeline中的所有步骤。</li>
<li>在stage中定义的environment指令只将给定的环境变量应用于stage中的步骤。</li>
<li>environment块具有定义的帮助方法credentials() 可用于通过Jenkins环境中的标识符来访问预定义的凭据。</li>
</ul>
<h4 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h4><font color="red">options</font>指令允许在管线本身内配置Pipeline特定的选项。Pipeline提供了许多这些选项, 如<font color="red">buildDiscarder</font>, 但它们也可能由插件提供, 如时间戳<font color="red">timestamps</font>。<br><table><thead><tr><th>Required</th><th>No</th></tr></thead><tbody><tr><td>Parameters</td><td>None</td></tr><tr><td>Allowed</td><td>Only Once, inside the <font color="red">pipeline</font> block</td></tr></tbody></table><br><br>#### Available Options<br><br>###### buildDiscarder<br><br>持久性工件(Persist artifacts)和控制台输出的特定数量的最近Pipeline运行。例如：<font color="red">options { buildDiscarder(logRotator(numToKeepStr: ‘1’)) }</font>。<br><br>###### disableConcurrentBuilds<br>不允许并发执行Pipeline。可用于防止同时访问共享资源等。例如：<font color="red">options { disableConcurrentBuilds() }</font>。<br><br>###### overrideIndexTriggers<br>允许重写分支索引触发器的默认处理。如果在 multibranch 或组织标签中禁用了分支索引触发器, 则<font color="red">options {overrideIndexTriggers (true)}</font>将仅为该作业启用它们。否则,<font color="red">options {overrideIndexTriggers (false)}</font>将仅禁用此作业的分支索引触发器。<br><br>###### skipDefaultCheckout<br>在agent指令中, 在默认情况下跳过源代码管理中的签出。例如: <font color="red">options {skipDefaultCheckout ()}</font>。<br><br>###### skipStageAfterUnstable<br>一旦生成状态不稳定, 就跳过各个阶段。例如: <font color="red">options {skipStagesAfterUnstable ()}</font>。<br><br>###### timeout<br>设置Pipeline运行的超时期限, 之后Jenkins应中止Pipeline。例如: <font color="red">options { timeout(time: 1, unit: ‘HOURS’) }</font>。<br><br>###### retry<br>失败时, 请在指定的次数内重试整个管线。例如: <font color="red">options { retry(3) }</font>。<br><br>###### timestamps<br>将管线所生成的所有控制台输出与发出该行的时间放在一起。例如: <font color="red">options { timestamps() }</font>。<br><br>###### Examples<br><br><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/10.png"><br><br>* 指定一个小时的全局执行超时, 之后Jenkins将中止Pipeline运行。<br>提示：可供选择的综合清单尚待<a href="https://issues.jenkins-ci.org/browse/INFRA-1053" target="_blank" rel="noopener">INFRA-1503</a>完成。<br><br>#### parameters<br>参数<font color="red">parameters</font>指令提供用户在触发Pipeline时应提供的参数列表。这些用户指定的参数的值可通过参数<font color="red">params</font>对象提供给Pipeline steps, 请参阅<a href="https://jenkins.io/doc/book/pipeline/syntax/#parameters-example" target="_blank" rel="noopener">]示例</a>中的特定用法。<br><table><thead><tr><th>Required</th><th>No</th></tr></thead><tbody><tr><td>Parameters</td><td>None</td></tr><tr><td>Allowed</td><td>Only Once, inside the <font color="red">pipeline</font> block</td></tr></tbody></table><br><br>#### Available Parameters<br>###### string<br>字符串类型参数，例如：<font color="red">parameters { string(name: ‘DEPLOY_ENV’, defaultValue: ‘staging’, description: ‘’) }</font>

<h6 id="booleanParam"><a href="#booleanParam" class="headerlink" title="booleanParam"></a>booleanParam</h6><p>布尔值参数，例如：<font color="red">parameters { booleanParam(name: ‘DEBUG_BUILD’, defaultValue: true, description: ‘’) }</font></p>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/11.png"></p>
<p>提示：可供选择的综合清单尚待<a href="https://issues.jenkins-ci.org/browse/INFRA-1053" target="_blank" rel="noopener">INFRA-1503</a>完成。</p>
<h6 id="Triggers"><a href="#Triggers" class="headerlink" title="Triggers"></a>Triggers</h6><p><font color="red">triggers</font>指令定义了Pipeline应 re-triggered 的自动方式。对于与源 (如 GitHub 或 BitBucket) 集成的管线, 可能不需要<font color="red">triggers</font>, 因为 webhooks-based 集成可能已经存在。当前可用的触发器有 <font color="red">cron</font>、<font color="red">pollSCM</font> 和<font color="red">upstream</font>。</p>
<table><thead><tr><th>Required</th><th>No</th></tr></thead><tbody><tr><td>Parameters</td><td>None</td></tr><tr><td>Allowed</td><td>Only Once, inside the <font color="red">pipeline</font> block</td></tr></tbody></table>

<h6 id="Cron"><a href="#Cron" class="headerlink" title="Cron"></a>Cron</h6><p>接受一个 cron 样式的字符串来定义Pipeline应 re-triggered 的规则间隔。例如：<font color="red">triggers { cron(‘H */4 <em> </em> 1-5’) }</font>。</p>
<h6 id="pollSCM"><a href="#pollSCM" class="headerlink" title="pollSCM"></a>pollSCM</h6><p>接受一个 cron 样式的字符串来定义一个规则的时间间隔, 詹金斯应该检查新的源更改。例如：<font color="red">triggers { pollSCM(‘H */4 <em> </em> 1-5’) }</font>。</p>
<h6 id="upstream"><a href="#upstream" class="headerlink" title="upstream"></a>upstream</h6><p>接受一个逗号分隔的作业字符串和一个阈值。当字符串中的任何作业以最小阈值结束时, 管线将被 re-triggered。例如：<font color="red">triggers { upstream(upstreamProjects: ‘job1,job2’, threshold: hudson.model.Result.SUCCESS) }</font>。<br>提示：pollSCM触发器只在Jenkins版本2.22或者以后有效。。</p>
<h6 id="Example-5"><a href="#Example-5" class="headerlink" title="Example"></a>Example</h6><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/12.png"></p>
<h6 id="stage"><a href="#stage" class="headerlink" title="stage"></a>stage</h6><p><font color="red">stage</font>指令进入<font color="red">stages</font>部分，应该包含一个steps部分，一个可选的agent部分，或者其它特殊平台指令。实际上, Pipeline所完成的所有工作都将在一个或多个<font color="red">stage</font>指令中进行包装。</p>
<table><thead><tr><th>Required</th><th>At least one</th></tr></thead><tbody><tr><td>Parameters</td><td>One mandatory parameter, a string for the name of the stage.</td></tr><tr><td>Allowed</td><td>Inside the <font color="red">stages</font> section</td></tr></tbody></table>

<h6 id="Example-6"><a href="#Example-6" class="headerlink" title="Example"></a>Example</h6><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/13.png"></p>
<h6 id="tools"><a href="#tools" class="headerlink" title="tools"></a>tools</h6><p>定义用于自动和放置<font color="red">PATH</font>的工具的部分。如果<font color="red">agent none</font>指定, 则忽略此项。</p>
<table><thead><tr><th>Required</th><th>No</th></tr></thead><tbody><tr><td>Parameters</td><td>None</td></tr><tr><td>Allowed</td><td>Inside the <font color="red">pipeline</font> block or a <font color="red">stage</font> block.</td></tr></tbody></table>


<h6 id="Supported-Tools"><a href="#Supported-Tools" class="headerlink" title="Supported Tools"></a>Supported Tools</h6><h6 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h6><h6 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h6><h6 id="gradle"><a href="#gradle" class="headerlink" title="gradle"></a>gradle</h6><h6 id="Example-7"><a href="#Example-7" class="headerlink" title="Example"></a>Example</h6><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/14.png"></p>
<ul>
<li>工具名称必须在Jenkins中预先配置：Manage Jenkins → Global Tool Configuration。</li>
</ul>
<h6 id="when"><a href="#when" class="headerlink" title="when"></a>when</h6><p><font color="red">when</font>指令允许Pipeline根据给定的条件来决定是否执行stage。<font color="red">when</font>指令必须包含至少一个条件。如果<font color="red">when</font>指令包含多个条件时, 所有子条件必须返回 true 才能执行阶段。这与子条件嵌套在<font color="red">allof</font>条件下的情况相同 (请参见下面的<a href="https://jenkins.io/doc/book/pipeline/syntax/#when-example" target="_blank" rel="noopener">示例</a>)。</p>
<p>可以使用嵌套条件构建更复杂的条件结构: <font color="red">not</font>、<font color="red">allOf</font>或<font color="red">anyOf</font>。嵌套条件可以嵌套到任意深度。</p>
<table><thead><tr><th>Required</th><th>No</th></tr></thead><tbody><tr><td>Parameters</td><td>None</td></tr><tr><td>Allowed</td><td>Inside a <font color="red">stage</font> directive</td></tr></tbody></table>

<h6 id="Built-in-Conditions"><a href="#Built-in-Conditions" class="headerlink" title="Built-in Conditions"></a>Built-in Conditions</h6><h6 id="branch"><a href="#branch" class="headerlink" title="branch"></a>branch</h6><p>在所构建的分支与给定的分支模式匹配时执行stage，例如：<font color="red">when { branch ‘master’ }</font>。注意：这仅仅在multibranch Pipeline有效。</p>
<h6 id="environment-1"><a href="#environment-1" class="headerlink" title="environment"></a>environment</h6><p>特殊环境变量被设置给定值以后，执行stage，例如：<font color="red">when { environment name: ‘DEPLOY_TO’, value: ‘production’ }</font>。</p>
<h6 id="expression"><a href="#expression" class="headerlink" title="expression"></a>expression</h6><p>当指定的Groovy表达式计算为真时执行stage，例如：<font color="red">when { expression { return params.DEBUG_BUILD } }</font>。</p>
<h6 id="not"><a href="#not" class="headerlink" title="not"></a>not</h6><p>当嵌套条件为假时执行stage。例如：<font color="red">when { not { branch ‘master’ } }</font>。</p>
<h6 id="allOf"><a href="#allOf" class="headerlink" title="allOf"></a>allOf</h6><p>当所有嵌套条件为真时执行stage。必须包含至少一个条件，例如：<font color="red">when { allOf { branch ‘master’; environment name: ‘DEPLOY_TO’, value: ‘production’ } }</font>。</p>
<h6 id="anyOf"><a href="#anyOf" class="headerlink" title="anyOf"></a>anyOf</h6><p>当至少一个前条件为真时执行stage。必须包含至少一个条件，例如：<font color="red">when { anyOf { branch ‘master’; branch ‘staging’ } }</font>。</p>
<h6 id="Examples-1"><a href="#Examples-1" class="headerlink" title="Examples"></a>Examples</h6><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/15.png"></p>
<p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/16.png"></p>
<p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/17.png"></p>
<p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/18.png"></p>
<p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/19.png"></p>
<h2 id="Parallel"><a href="#Parallel" class="headerlink" title="Parallel"></a>Parallel</h2><p>申明式Pipeline中有可能在里面申明许多嵌套的stages，这些stage将被并行执行。请注意, 一个stage必须有一个且只有一个<font color="red">steps</font>或<font color="red">parallel</font>。嵌套stage本身不能包含进一步的<font color="red">parallel</font> stages, 但其他的行为与其他<font color="red">stages</font>相同。包含<font color="red">parallel</font>的任何stage都不能包含<font color="red">agent</font>或<font color="red">tools</font>, 因为没有<font color="red">steps</font>，他们并不具有相关性。</p>
<p>此外, 您可以强制您的<font color="red">parallel stage</font>全部被中止, 当其中一个失败, 通过增加’failFast true’到包含<font color="red">parallel</font>的<font color="red">stage</font>。</p>
<h4 id="Example-8"><a href="#Example-8" class="headerlink" title="Example"></a>Example</h4><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/20.png"></p>
<h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><p>声明式Pipeline可能会使用<a href="https://jenkins.io/doc/pipeline/steps" target="_blank" rel="noopener">Pipeline steps reference</a>中记录的所有可用steps, 其中包含一个完整的steps列表, 其中添加了仅在声明性Pipeline中支持的下面列出的steps。</p>
<h6 id="script"><a href="#script" class="headerlink" title="script"></a>script</h6><p>script step采用了一个<a href="https://jenkins.io/doc/book/pipeline/syntax/#scripted-pipeline" target="_blank" rel="noopener">脚本化的Pipeline块</a>, 并在声明性Pipeline中执行。对于大多数用例, 脚本步骤在声明性Pipeline中应该是不必要的, 但它可以提供一个有用的”escape hatch”。 Script块和/或复杂性的脚本script块应该改为<a href="https://jenkins.io/doc/book/pipeline/shared-libraries/" target="_blank" rel="noopener">]共享库</a>。</p>
<h6 id="Example-9"><a href="#Example-9" class="headerlink" title="Example"></a>Example</h6><p><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/21.png"></p>
<h2 id="Scripted-Pipeline"><a href="#Scripted-Pipeline" class="headerlink" title="Scripted Pipeline"></a>Scripted Pipeline</h2><p>脚本化Pipeline (如<a href="https://jenkins.io/doc/book/pipeline/syntax/#declarative-pipeline" target="_blank" rel="noopener">声明式Pipeline</a>) 建立在底层管线子系统的顶部。不像声明式, 脚本Pipeline是有效的通用 DSL 内置的 Groovy。Groovy 语言提供的大多数功能都可供脚本Pipeline用户使用, 这意味着它可以是一个非常富有表现力和灵活性的工具, 可以创作连续的交付Pipeline。</p>
<h2 id="Flow-Control"><a href="#Flow-Control" class="headerlink" title="Flow Control"></a>Flow Control</h2><p>脚本化Pipeline从 Jenkinsfile 的顶部向下连续执行, 就像 Groovy 或其他语言中的大多数传统脚本一样。因此, 提供流控制依赖于 Groovy 表达式, 如 if/else 条件, 例如:<br><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/22.png"></p>
<p>通过 Groovy 的异常处理支持, 可以管理另一种脚本式Pipeline流控制。当steps因任何原因而失败时, 它们抛出一个异常。错误处理行为必须使用 Groovy 中的 try/catch/finally 块, 例如:<br><img src="http://oow5aq3zy.bkt.clouddn.com/image/pp7/23.png"></p>
<h2 id="Steps-1"><a href="#Steps-1" class="headerlink" title="Steps"></a>Steps</h2><p>正如在入门中所讨论的, Pipeline最基本的部分是”step”。从根本上讲, step告诉Jenkins该做什么, 并充当声明性和脚本化Pipeline语法的基本构建基块。<br>脚本Pipeline不引入特定于其语法的任何steps; <a href="https://jenkins.io/doc/pipeline/steps" target="_blank" rel="noopener">Pipeline Steps reference</a>, 其中包含Pipeline和插件提供的steps的全面列表。</p>
<h2 id="Differences-from-plain-Groovy"><a href="#Differences-from-plain-Groovy" class="headerlink" title="Differences from plain Groovy"></a>Differences from plain Groovy</h2><p>为了提供耐用性, 这意味着运行Pipeline可以生存的Jenkins master重启, 脚本Pipeline必须序列化数据回master。由于这一设计要求, 一些 Groovy 成语如<font color="red">collection.each { item -&gt; /* perform operation */ }</font>不完全受支持。有关详细信息, 请参阅 <a href="https://issues.jenkins-ci.org/browse/JENKINS-27421" target="_blank" rel="noopener">JENKINS-27421</a> 和 <a href="https://issues.jenkins-ci.org/browse/JENKINS-26481" target="_blank" rel="noopener">JENKINS-26481</a>。</p>
<h2 id="Syntax-Comparison"><a href="#Syntax-Comparison" class="headerlink" title="Syntax Comparison"></a>Syntax Comparison</h2><p>当Jenkins Pipeline首次创建时, Groovy 被选为基础。Jenkins长期推出了一个嵌入式的 Groovy 引擎, 为管理员和用户提供高级脚本功能。此外, Jenkins Pipeline的实现基于 Groovy 的基础上, 建立现在称为”脚本Pipeline” DSL。</p>
<p>由于它是一个功能完备的编程环境, 因此脚本化的管道为Jenkins用户提供了大量的灵活性和可扩展性。对于给定团队的所有成员来说, Groovy 学习曲线通常并不可取, 因此创建了声明性Pipeline, 为创作Jenkins Pipeline提供了更简单、更可用的语法。</p>
<p>两者基本上是相同的Pipeline子系统下面。它们都是作为”代码即管道(Pipeline as code)”的持久实现。他们都能够使用Pipeline内置的steps或由插件提供。都可以利用<a href="https://jenkins.io/doc/book/pipeline/shared-libraries/" target="_blank" rel="noopener">共享库</a>。</p>
<p>然而他们不同的地方在句法和灵活性。声明性限制用户使用更严格和预先定义的结构, 使其成为更简单的连续传递Pipeline的理想选择。脚本提供的限制很少, 因为结构和语法的唯一限制往往是由 Groovy 本身定义的, 而不是任何特定于Pipeline的系统, 这使得它成为了电力用户和更复杂需求的理想选择。顾名思义, 声明性Pipeline是鼓励一个声明式编程模型。而脚本化的Pipeline遵循更命令性的编程模型。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://roclli.github.io/2017/12/13/Pipeline7-Pipeline-Syntax/" data-id="cjb4meswi001u1r7s7cfvaniz" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins-Pipeline-Docker/">Jenkins; Pipeline; Docker</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/13/PP1-Demo-Helloworld/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          Pipeline1-Demo-Helloworld
        
      </div>
    </a>
  
  
    <a href="/2017/12/13/Pipeline6-Pipeline-Development-Tools/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">(原创)Pipeline6-Pipeline-Development-Tools</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-OOM-Java内存溢出-OutOfMemoryError/">Java; OOM; Java内存溢出; OutOfMemoryError</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins-Pipeline/">Jenkins; Pipeline</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins-Pipeline-Docker/">Jenkins; Pipeline; Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pipeline-Jenkins/">Pipeline; Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pipeline-Jenkins-Docker/">Pipeline; Jenkins; Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pipeline-Jenkins-Docker-Dockerfile/">Pipeline; Jenkins; Docker; Dockerfile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grep-linux-shell-log-file-check/">grep; linux shell; log file check</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java-OOM-Java内存溢出-OutOfMemoryError/" style="font-size: 10px;">Java; OOM; Java内存溢出; OutOfMemoryError</a> <a href="/tags/Jenkins-Pipeline/" style="font-size: 13.33px;">Jenkins; Pipeline</a> <a href="/tags/Jenkins-Pipeline-Docker/" style="font-size: 10px;">Jenkins; Pipeline; Docker</a> <a href="/tags/Pipeline-Jenkins/" style="font-size: 20px;">Pipeline; Jenkins</a> <a href="/tags/Pipeline-Jenkins-Docker/" style="font-size: 10px;">Pipeline; Jenkins; Docker</a> <a href="/tags/Pipeline-Jenkins-Docker-Dockerfile/" style="font-size: 16.67px;">Pipeline; Jenkins; Docker; Dockerfile</a> <a href="/tags/grep-linux-shell-log-file-check/" style="font-size: 10px;">grep; linux shell; log file check</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/12/13/PP4-Demo-sidecar-script-2/">PP4-Demo-sidecar-script-2</a>
          </li>
        
          <li>
            <a href="/2017/12/13/PP4-Demo-sidecar-script-1/">PP4-Demo-sidecar-script-1</a>
          </li>
        
          <li>
            <a href="/2017/12/13/PP4-Demo-dockerfile-declarative/">PP4-Demo-dockerfile-declarative</a>
          </li>
        
          <li>
            <a href="/2017/12/13/PP4-Demo-multip-container-script/">PP4-Demo-multip-container-script</a>
          </li>
        
          <li>
            <a href="/2017/12/13/PP4-Demo-multip-container-declarative/">PP4-Demo-multip-container-declarative</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 roclli<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>